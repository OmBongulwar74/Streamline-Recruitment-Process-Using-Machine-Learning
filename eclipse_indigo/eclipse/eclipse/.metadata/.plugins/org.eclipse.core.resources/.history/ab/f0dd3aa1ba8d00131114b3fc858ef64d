package database;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import Service.GeneratePassword;
import bean.DoctorBean;
import bean.LoginBean;
import bean.PatientBean;

import database.DAO;

public class DAOQueries {

	public boolean isLoginSuccess(LoginBean loginInfo) {
		
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "select * from  login where emailid=? and password = ?";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, loginInfo.getUsername());
			preparedStatement.setString(2, loginInfo.getPassword());
			// execute insert SQL statement
			ResultSet result=preparedStatement.executeQuery();
			if(result.next())
				return true;
			

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
		// TODO Auto-generated method stub
		return false;
	}

	public int createPatientLogin(PatientBean bean) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		// Generate password
		String password=GeneratePassword.randomPasswordIs();
		bean.setPassword(password);
		// Insert into Login Table
		String insertQuery = "insert into Login values(?,?,'Patient')";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(insertQuery);
			preparedStatement.setString(1, bean.getEmailId());
			preparedStatement.setString(2, bean.getPassword());
			insertPatientProfile(bean);
		return	preparedStatement.executeUpdate();
		}
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
		return 0;
		
		
	}

	

	private int insertPatientProfile(PatientBean bean) {
		// TODO Auto-generated method stub
		System.out.println("In Patient Bean");
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "insert into PatientRegistration values(?,?,?,?,?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, bean.getFirstName());
			preparedStatement.setString(2, bean.getLastName());
			preparedStatement.setString(3, bean.getDateOfBirth());
			preparedStatement.setString(4, bean.getAddress());
			preparedStatement.setString(5, bean.getCountry());
			preparedStatement.setInt(6, bean.getPostCode());
			preparedStatement.setString(7, bean.getTelephone());
			// execute insert SQL statement
				return preparedStatement.executeUpdate();
			

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
return 0;
		
	}

	public int createDoctorLogin(DoctorBean bean) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		// Generate password
		String password=GeneratePassword.randomPasswordIs();
		bean.setPassword(password);
		// Insert into Login Table
		String insertQuery = "insert into Login values(?,?,'Doctor')";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(insertQuery);
			preparedStatement.setString(1, bean.getEmailId());
			preparedStatement.setString(2, bean.getPassword());
		return	preparedStatement.executeUpdate();
		}
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return 0;
	}

}
