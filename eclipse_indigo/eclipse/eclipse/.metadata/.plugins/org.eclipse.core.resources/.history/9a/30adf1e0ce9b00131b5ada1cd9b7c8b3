package database;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

import com.mysql.jdbc.exceptions.jdbc4.MySQLIntegrityConstraintViolationException;

import converter.AppointmentConverter;

import Service.GeneratePassword;
import bean.AppointmentDetail;
import bean.DoctorBean;
import bean.LoginBean;
import bean.PatientBean;
import bean.PostBean;

import database.DAO;

public class DAOQueries {

	public String isLoginSuccess(LoginBean loginInfo) {
		
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "select * from  login where emailid=? and password = ?";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, loginInfo.getUsername());
			preparedStatement.setString(2, loginInfo.getPassword());
			
			// execute insert SQL statement
			ResultSet result=preparedStatement.executeQuery();
			if(result.next())
			{
				return result.getString(3);
			}
			

		}
		
		
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
		// TODO Auto-generated method stub
		return null;
	}

	public int createPatientLogin(PatientBean bean) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		// Generate password
		String password=GeneratePassword.randomPasswordIs();
		bean.setPassword(password);
		// Insert into Login Table
		String insertQuery = "insert into Login values(?,?,'Patient')";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(insertQuery);
			preparedStatement.setString(1, bean.getEmailId());
			preparedStatement.setString(2, bean.getPassword());
			
		int row=	preparedStatement.executeUpdate();
		insertPatientProfile(bean);
		return row;
		}
		catch(MySQLIntegrityConstraintViolationException e)
		{
			System.out.println("Already Present");
		}
		
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
		return 0;
		
		
	}

	

	private int insertPatientProfile(PatientBean bean) {
		// TODO Auto-generated method stub
		System.out.println("In Patient Bean");
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "insert into PatientRegistration values(?,?,?,?,?,?,?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, bean.getFirstName());
			preparedStatement.setString(2, bean.getLastName());
			preparedStatement.setString(3, bean.getDateOfBirth());
			preparedStatement.setString(4, bean.getAddress());
			preparedStatement.setString(5, bean.getCountry());
			preparedStatement.setInt(6, bean.getPostCode());
			preparedStatement.setString(7, bean.getTelephone());
			preparedStatement.setString(8, bean.getEmailId());
			// execute insert SQL statement
				return preparedStatement.executeUpdate();
			

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
return 0;
		
	}

	public int createDoctorLogin(DoctorBean bean) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		// Generate password
		String password=GeneratePassword.randomPasswordIs();
		bean.setPassword(password);
		// Insert into Login Table
		String insertQuery = "insert into Login values(?,?,'Doctor')";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(insertQuery);
			preparedStatement.setString(1, bean.getEmailId());
			preparedStatement.setString(2, bean.getPassword());
		int row =preparedStatement.executeUpdate();
		insertDoctorProfile(bean);
		}
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		return 0;
	}

	private void insertDoctorProfile(DoctorBean bean) {
		// TODO Auto-generated method stub

		System.out.println("In Doctor Bean");
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "insert into DoctorRegistration values(?,?,?,?,?,?,?,?,?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, bean.getFirstName());
			preparedStatement.setString(2, bean.getLastName());
			preparedStatement.setString(3, bean.getDateOfBirth());
			preparedStatement.setString(4, bean.getSpecialty());
			preparedStatement.setString(5, bean.getLicenseNumber());
			preparedStatement.setString(6, bean.getAddress());
			preparedStatement.setInt(7, bean.getPostCode());
			preparedStatement.setString(8, bean.getTelephone());
			preparedStatement.setString(9, bean.getCountry());
			preparedStatement.setString(10, bean.getEmailId());
			// execute insert SQL statement
				preparedStatement.executeUpdate();
			

		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		

	}

	public void setPassword(String newpwd, String userName) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String updatepwdQuery="Update Login set password=? where emailid=?";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(updatepwdQuery);
			preparedStatement.setString(1, newpwd);
			preparedStatement.setString(2, userName);
			
			// execute insert SQL statement
				preparedStatement.executeUpdate();
			
System.out.println("Password Change");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
	}

	public void insertQuery(String postQuery, String username) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String updatepwdQuery="insert into postquery values(?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(updatepwdQuery);
			preparedStatement.setString(1, username);
			preparedStatement.setString(2, postQuery);
			
			
			// execute insert SQL statement
				preparedStatement.executeUpdate();
			
System.out.println("Query Updated");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}


		
	}

	public ArrayList<String> viewpostQuery(String query) {
		// TODO Auto-generated method stub
		ArrayList<String> comments= new ArrayList<String>();
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "select * from  comments where query=?";
		PreparedStatement preparedStatement;
		
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, query);
			
			// execute insert SQL statement
			ResultSet result=preparedStatement.executeQuery();
			
			while(result.next())
			{
				System.out.println(result.getString(2));
			comments.add(result.getString(2));
			}
			

		}
		
		
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return comments;
	}

	public ArrayList<String> getAllPosts(String username) {
		// TODO Auto-generated method stub
		ArrayList<String> viewPost= new ArrayList<String>();
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "select * from  postquery where emailid like ?";
		PreparedStatement preparedStatement;
		
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			preparedStatement.setString(1, username);
			
			// execute insert SQL statement
			ResultSet result=preparedStatement.executeQuery();
			
			while(result.next())
			{
				System.out.println("View All"+result.getString(2));
				viewPost.add(result.getString(2));
			}
			

		}
		
		
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return viewPost;
	
	}

	public void insertComment(String query, String comment) {
		// TODO Auto-generated method stub
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String updatepwdQuery="insert into comments values(?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(updatepwdQuery);
			preparedStatement.setString(1, query);
			preparedStatement.setString(2, comment);
			
			
			// execute insert SQL statement
				preparedStatement.executeUpdate();
			
System.out.println("Comments Updated");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}


		
	}

	public ArrayList<String> getDoctorList() {
		// TODO Auto-generated method stub
		ArrayList<String> doctorList= new ArrayList<String>();
		DAO data=new DAO();
		Connection conn=data.getConnection();
		String validateUser = "select a.firstname from DoctorRegistration as a , Login as b where a.emailid=b.emailid and b.usertype='Doctor'";
		PreparedStatement preparedStatement;
		
		try {
			preparedStatement = conn.prepareStatement(validateUser);
			// execute insert SQL statement
			ResultSet result=preparedStatement.executeQuery();
			
			while(result.next())
			{
				System.out.println(result.getString(1));
			doctorList.add(result.getString(1));
			}
			

		}
		
		
		catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		return doctorList;

	}

	public void insertAppointmentDetails(
			AppointmentDetail appointmentDetails.getDoctorName(), String userName) {
		// TODO Auto-generated method stub

		DAO data=new DAO();
		Connection conn=data.getConnection();
		String updatepwdQuery="insert into AppointmentDetail values(?,?,?,?,?,?)";
		PreparedStatement preparedStatement;
		try {
			preparedStatement = conn.prepareStatement(updatepwdQuery);
			preparedStatement.setString(1, userName);
			preparedStatement.setString(2, appointmentDetails.getDoctorName());
			
			
			// execute insert SQL statement
				preparedStatement.executeUpdate();
			
System.out.println("Comments Updated");
		} catch (SQLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}



	}

}
